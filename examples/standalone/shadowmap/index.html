<!doctype html>
<html>
<head>
<title>GLBoost Primitives example</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" href="app.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser-polyfill.min.js"></script>
<script src="../../../build/glboost.js"></script>
</head>
<body>
<header>
  <p class="header-title">GLBoost Primitives example</p>
</header>
<main>
  <canvas id="world" width="600" height="600"></canvas>
</main>
<script>
  var DEPTH_TEXTURE_SIZE = 512;


  var arg = new Object;
  var pair = location.search.substring(1).split('&');
  for(var i = 0; pair[i] ; i++) {
    var kv = pair[i].split('=');
    arg[kv[0]] = kv[1];
  }

  GLBoost.TARGET_WEBGL_VERSION = arg.webglver ? parseInt(arg.webglver) : 1;

  var canvas = document.getElementById("world");

  var renderer = new GLBoost.Renderer({
    canvas: canvas,
    clearColor: {
      red: 1.0,
      green: 1.0,
      blue: 1.0,
      alpha: 1
    }
  });

  var scene = new GLBoost.Scene();
  var glBoostContext = GLBoost.GLBoostContext.getInstance();
  var depthTexture = glBoostContext.createTexturesForRenderTarget(DEPTH_TEXTURE_SIZE, DEPTH_TEXTURE_SIZE, 1);
  var renderPaths = glBoostContext.createRenderPasses(2);

  var material = new GLBoost.ClassicMaterial();
  var texture = new GLBoost.Texture('resources/texture.png');
  material.diffuseTexture = texture;

  var planeGeometry = new GLBoost.Plane(10, 10, 10, 10, null);
  var plane = new GLBoost.Mesh(planeGeometry, material);
  scene.addChild( plane );

  var cubeGeometry = new GLBoost.Cube(new GLBoost.Vector3(1,1,1), new GLBoost.Vector4(1,1,1,1));
  var cube = new GLBoost.Mesh(cubeGeometry, material);
  cube.translate = new GLBoost.Vector3(0,2,0);
  scene.addChild( cube );

  var camera = new GLBoost.Camera(
      {
        eye: new GLBoost.Vector3(0.0, 5, 15.0),
        center: new GLBoost.Vector3(0.0, 5.0, 0.0),
        up: new GLBoost.Vector3(0.0, 1.0, 0.0)
      },
      {
        fovy: 45.0,
        aspect: 1.0,
        zNear: 0.1,
        zFar: 300.0
      }
  );
  scene.addChild( camera );

  /*
  renderPaths[0].addElements([camera, cube, plane]);
  renderPaths[0].setClearColor([0, 0, 0, 1]);
  renderPaths[0].specifyRenderTargetTextures(renderTextures);
    */

  scene.prepareForRender();

  var glBoostMonitor = GLBoost.GLBoostMonitor.getInstance();
  glBoostMonitor.printGLBoostObjects();
  glBoostMonitor.printWebGLResources();

  var render = function() {
    renderer.clearCanvas();
    renderer.draw(scene);

    var rotateMatrix = GLBoost.Matrix33.rotateY(-1.0);
    var rotatedVector = rotateMatrix.multiplyVector(camera.eye);
    camera.eye = rotatedVector;

    requestAnimationFrame(render);
  };

  render();

</script>
</body>
</html>
